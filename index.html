<html>
<head>
	<title>FÃ¡ilteoir</title>
	<link rel="stylesheet" type="text/css" href="css/clippy.css" media="all">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="js/clippy.min.js"></script>
<script type="text/javascript">
  var magent;
  clippy.load('Links', function(agent) {
    agent.show();
    magent = agent;
  });
</script>
	<script type="text/javascript"src="js/espeak.js"></script>
	<script>
var ctx = new (window.AudioContext || window.webkitAudioContext)();
var convolver = ctx.createConvolver();
convolver.connect(ctx.destination);
var espeak = new Espeak('js/espeak.worker.js', function cb() {
	espeak.setVoice.apply(espeak,['ga']);
});
var pusher;

var speak = function(text) {
  if (pusher) {
    pusher.disconnect();
    pusher = null;
  }
  var now = Date.now();
  var samples_queue = [];
  pusher = new PushAudioNode(ctx,
  function() {
    console.log('started!', ctx.currentTime, pusher.startTime);
  },
  function() {
    console.log('ended!', ctx.currentTime - pusher.startTime);
  });
  pusher.connect(ctx.destination);
  if(magent) {
    magent.speak(text);
    espeak.synth(text, function(samples, events) {
      if (!samples) {
        pusher.close();
        return;
      }
      pusher.push(new Float32Array(samples));
      if (now) {
        console.log("latency:", Date.now() - now);
        now = 0;
      }
    });
  }
}
</script>
</head>
<body>
	<button onclick="speak('dia dhuit');return false;">Talk</button>
<div id="audio"></div>
</body>
</html>
